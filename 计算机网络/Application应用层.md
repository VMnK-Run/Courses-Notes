<center><font color = 'red'><h3>
    Application应用层
    </h3></font></center>

---

#### 网络应用需求

+ 数据丢失(data loss)/可靠性(reliability)
  + 某些应用可忍受数据丢失-电话
  + 某些要求100%可靠的数据传输-邮件
+ 时间/延迟(delay)
  + 网络电话/游戏
+ 带宽（bandwidth）
  + 某些应用要求带宽达到一定要求：网络视频
  + 某些无所谓：下载，email

#### 传输服务

##### TCP

+ 面向连接:客户机和服务器进程需建立连接
+ 传输可靠
+ 控制流量-发送方速度不会过快
+ 负载过重可限制发送方发送速度
+ <font color = 'red'>不提供：</font>
  + 不提供时间 延迟保障
  + 不提供最小带宽保障

##### UDP

+ 无连接
+ 不可靠（数据丢失）
+ 不提供可靠性、流量控制、拥塞控制、延迟保障、带宽保障

+ 作用是：自由，给了掌控数据传输的能力
+ 网络电话可以使用UDP

### Web应用

> Tim Berners-Lee 发明了World Wide Web

URL：统一资源定位器

+ 格式:  Scheme://host:port/path

#### HTTP协议

> HyperText Transfer Protocol 超文本传输协议
>
> web应用遵循HTTP协议

+ C/S结构
  + 客户-浏览器
  + 服务器
+ 使用TCP传输服务
  + 服务器在80端口等待客户请求
  + 浏览器发起到服务器的TCP连接（创建socket）
  + 服务器接受TCP连接
  + 浏览器与web服务器交换http信息
  + 关闭TCP连接
+ 无状态协议
  + 服务器不维护任何有关于客户端过去请求的信息

#### HTTP连接

+ 非持久性连接

  + 每个TCP连接最多允许传输一个连接

  + ---

  + 每个对象需要2个RTT

  + 操作系统要为每个TCP连接开销资源

  + 浏览器会怎么做？

    + 打开多个并行的TCP连接以获取网页所需对象，但会对服务器端造成很大影响

+ 持久性连接

  + 每个TCP连接允许传输多个对象
  + 发送响应后服务器保持TCP连接的打开
  + 无流水持久性连接
    + 客户端只收到前一个相应才发送新请求
  + 流水机制的持久性连接
    + 流水线，所有引用对象耗时一个RTT

#### HTTP消息

请求消息

+ 用ASCII码：人直接可读
+ request line （GET，POST，HEAD commands）
+ header lines

上传输入的方法

+ POST方法
  + 网页填写表格
  + 在请求消息的消息体中上传
+ URL方法
  + GET方法
  + 输入信息通过request行的URL字段（带？的那个）

响应消息

+ status line
  + 200 OK
  + 301 Moved Permanently
  + 404 Not Found
+ header lines

#### Cookie技术

> 很多应用需要服务器掌握客户端的状态

网站为了辨别用户身份，进行跟踪而存储在用户本地终端上的数据

+ HTTP响应消息的cookie头部行
+ HTTP请求消息的cookie头部行
+ 客户端主机上的cookies文件由浏览器管理
+ 服务器端后台数据库

作用

+ 身份认证（一段时间内不用输入密码）
+ 购物车
+ 推荐

隐私问题！！！

#### Web缓存/代理服务器

功能

+ 不访问服务器的前提下满足客户端的HTTP请求

浏览器向缓存/代理服务器发送所有HTTP请求

+ 如果在缓存中，返回
+ 若没有，向原始服务器发送HTTP请求，同时保存该对象
+ 一般由ISP架设

问题：缓存上的和服务器上的是否一样？（是否是最新版本）

解决：条件性GET方法

+ 目标：若缓存有最新版本，不发送请求
+ 在HTTP请求消息中声明所持有版本的日期
+ 也就是cache向server问是不是modified（标定日期）

代理服务器proxy？

### HTTP其他

+ HTTP1.1 先到先服务FCFS
+ HTTP2：？

### Email应用

异步应用

#### 构成

+ 邮件客户端---浏览器、foxmail
+ 邮件服务器 mail server
  + 邮箱：存储发给该用户的email
  + 消息队列
+ SMTP协议
  + 邮件服务器之间传递消息
  + 客户端：发送消息的服务器
  + 服务器：接收消息的服务器

> 不依赖于是否有网，想发就发，不用管对方在不在线

+ SMTP协议：RFC 2821
  + 采取TCP进行可靠传输
  + 端口25
  + 传输三阶段
    + 握手
    + 消息传输
    + 关闭
  + 命令/响应（HTTP是请求响应）
  + 注：Email消息只能包含7位ASCII码

---

SMTP交互示例
