<center><h3>高级数据库模型</h3></center>

---

> 思考->高级设计->关系数据库模式->关系DBMS

#### 1. E/R模型

实体-联系模型：entity-relationship model

实体集，属性，联系

E/R图：描述实体集，属性和联系的图示

##### 1.1 E/R模型的组成

---

1. 实体集

   eneity set

+ 实体是某种抽象对象，相似实体的集合形成实体集
+ 实体集：类，实体：对象
+ 用矩形表示

2. 属性

   attribute

+ 实体集中实体所具有的属性

+ 用椭圆表示，主键加下划线

3. 联系

   relationship

   <u>***目的是：如果实体s出现在实体m中，m和s就被联系在一起***</u>

+ 两个或多个实体集的连接
+ E/R模型允许联系连接任意数目实体集
+ 用菱形表示

---

>  数据库并不由E/R模型实现，而只是设计

+ 每个实体集，数据库实例有一个特定的有限实体集合

+ 联系集：联系的表
  + 分量是实体

  + 元组是联系集中的

##### 1.2 E/R联系

二元联系理论上可以将一个实体集中任意数目实体与另一实体集中任意数目实体相连接

假设R连接实体集E和F，那么：

+ 多对一：E中任一实体与F中至多一个实体联系
+ 一对多：F中任一实体与E中至多一个实体联系
+ 一对一：一个实体最多和另一实体集中一个实体联系（既是多对一，又是一对多）
+ 多对多：既不是多对一，也不是一对多  

若E到F是多对一联系，把箭头指向F，若一对一，同时指向E和F（可以把联系理解为是一个桥）

+ 多路联系

---

联系中的角色：

+ 一个联系中一个实体集可能出现多次
+ 每一条连向实体集的连线代表实体集在联系中扮演的不同角色
+ 实体集和联系之间的边

联系的属性：

+ 联系可以有属性
+ 可以用一个实体集去替代这个属性，联系的属性是新实体集的属性

E/R模型的子类

实体集中有一些实体，拥有集合中其他实体成员没有的特殊性质，定义一些子类。

isa联系：

+ 连接实体集和它的子类
+ A是B表达了实体集A到B的isa联系
+ 用三角形表示，一对一联系
  + 边与子类相连，角与父类相连
+ 一个root实体集，最具概括性
+ 相当于是子类是对父类的继承，父类是一个抽象类

#### 2. 设计原则

+ 忠实性 faithfull
+ 避免冗余 avoiding redundanc
+ 简单性 simplicity ：除非有绝对需要，否则不再设计中添加更多成分

---

+ 选择正确的元素种类

  + 如何避免异常？采用属性还是属性集？

  如果要把E（实体集）用一个属性或几个其他实体集的属性代替：

  + 与E有关的联系必须有箭头指向E
  + 若E有几个属性，那必须没有属性依赖于其他属性（E的唯一键是它所有的属性）
  + 没有联系包含E多次

  这样做：

  + 若F到E有多对一联系R，删除R并把E作为F的属性（实体集的属性）
  + 若有多路联系的箭头指向E，把E作为R的属性（关系的属性）

#### 3. E/R模型中的约束

通过属性表示实体集的键

还需要一个集合中的实体和另外一个集合的实体相关联

+ E/R模型的键
  + 是一个或多个属性的集合K
  + E的不同实体e1和e2，他们的K中没有完全相同的值
  + 用下划线
  + <font color = 'red'>注意</font>
    + 每个实体集必须有一个键
    + 一个实体集可以有多个键
    + 一个实体集处于一个isa层次中时，要求根实体集拥有键所需的所有属性

+ 引用完整性：
  + 圆箭头指向F表示此联系从E到F不仅是多对一或一对一，同时要求与给定的E实体相连的F实体需要存在
+ 度约束：
  + 可被联系到的实体数目的约束

#### 4. 弱实体集

weak entity set 

+ 一些实体不能独立存在
  + 需要有其他实体才能确定这个实体
+ 一个实体集键由另一个实体集的部分或全部属性构成
+ 双矩形：若实体集
+ 双菱形：一个多对一的联系
+ 说白了就是它的键由它自己的属性和另一个实体集里的属性组成

要求：

+ 若E是弱实体集，则它的键组成为：
  + 零个或多个它自己的属性（即不独立存在）
  + 从E到其他实体集的**多对一**联系连接的键属性，这些联系称为E的**支持联系**（supporting relationships），从E到达的实体集位支持实体集（supporting entity set）
+ 为了使从E到F的联系R成为一个支持联系，必须服从：
  + R使二元的多对一联系
  + R必须有E到F的引用完整性，即圆箭头（相联系的实体F必须存在于数据库中）
  + F提供给E的属性必须是F的键
  + 如果F本身是弱实体集，那么F提供给E的F的键属性是另外的实体集的键属性（递归）
  + 如果E到F有多个支持联系，每个联系用来提供一份F的键的拷贝

---

符号：

+ 双边矩形
+ 多对一联系显示为双边菱形
+ 如果一个实体集为他自己的键提供了属性，属性带有下划线（就是说是键）

#### 5. 从E/R图到关系设计

> 每个实体集可以转化为具有相同属性集的关系
>
> 联系也用关系替代

##### 5.1 实体集到关系的转化

**属性就是实体集属性**，这很容易（所有属性）

##### 5.2 联系到关系的转化

E/R模型中的联系也可以用关系来表示

属性：

1. 联系的实体集的键属性或属性集
2. 联系本身的属性

为了避免多次出现，有时要对键属性重命名

##### 5.3 关系组合

一些情况：一个实体集E和E到F的多对一联系R，需要采用组合关系，相应的模式包括：

1. E的所有属性
2. F的键属性
3. 联系R上的任何属性

注：把E和涉及E但是不涉及从E到其他实体的多对一联系R组合起来会有冗余

##### 5.4 弱实体集

有一个若实体集W，不能直接转化为关系

1. **不仅包含W的属性**，**还要包含相应支持实体集的键属性**
2. 与W相连的联系经转化后的关系必须包含W**键**属性（下划线的）（或许多次包含？）和对W键有贡献的实体集属性
3. 支持联系不必被转化为关系

修改规则：

+ 若W是一个弱实体集，W转化为关系后的模式组成为：
  + W的所有属性
  + W相连的支持联系的所有属性
  + W到实体集E的多对一联系，包含E的所有键属性
+ 不要为与W相连的支持联系构造关系
